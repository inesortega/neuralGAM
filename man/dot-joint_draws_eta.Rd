% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/predict.NeuralGAM.R
\name{.joint_draws_eta}
\alias{.joint_draws_eta}
\title{Joint MC-Dropout draws of the additive predictor on the link scale}
\usage{
.joint_draws_eta(ngam, x, eta_det, forward_passes = 300L, verbose = 0L)
}
\arguments{
\item{ngam}{A fitted \code{neuralGAM} object containing:
\itemize{
\item \code{model$linear}: the fitted linear (parametric) submodel, or \code{NULL};
\item \code{model[[tm]]}: Keras models for each smooth term \code{tm};
\item \code{formula$p_terms}, \code{formula$np_terms}: character vectors with
parametric and nonparametric term names;
\item \code{eta0}: (numeric) intercept on the link scale.
}}

\item{x}{A \code{data.frame} or \code{matrix} of covariates with the columns
expected by \code{ngam}. The number of rows defines \eqn{n}.}

\item{forward_passes}{Integer \eqn{B \ge 2}; number of Monte Carlo passes (default \code{300L}).}

\item{verbose}{Integer flag (0/1); controls optional messaging (unused at present).}

\item{eta}{The deterministic eta to be used for bias correction}
}
\value{
A numeric matrix of dimension \code{B x n} containing draws of
\eqn{\eta(\boldsymbol{x})} on the link scale (each row is one pass, each
column an observation).
}
\description{
Generate \strong{joint} draws of the additive predictor \eqn{\eta(\boldsymbol{x})}
on the link scale by combining:
\itemize{
\item \emph{Parametric} uncertainty via Gaussian draws of the linear
coefficients \eqn{\beta^{(b)} \sim \mathcal{N}(\hat\beta, \widehat{\mathrm{Var}}(\hat\beta))},
evaluated with the linear model matrix; and
\item \emph{Nonparametric} (smooth) epistemic uncertainty via Monte Carlo
Dropout draws, summing all smooth terms per pass.
}
The function returns a \eqn{B \times n} matrix of link-scale draws, where
\eqn{B} is the number of MC passes and \eqn{n} is the number of rows in \code{x}.
}
\details{
\strong{Parametric part:} draws are generated with \code{MASS::mvrnorm} from
\code{coef(linmod)} and \code{vcov(linmod)}; predictions are computed using the
linear submodel’s \emph{exact} model matrix (via \code{stats::model.frame} and
\code{stats::model.matrix}), excluding the intercept. If no parametric terms exist, this part contributes zeros.

\strong{Nonparametric part:} for each smooth term, the function calls
\code{.mc_dropout_forward()} and sums the chosen “mean” head across terms per pass.
If a smooth model cannot produce draws (e.g., errors), a deterministic prediction
is used (no extra variance contribution).

The returned draws include the intercept \code{eta0} and are bias corrected.
}
\seealso{
\code{\link{.parametric_draws}}, \code{\link{.mc_dropout_forward}}
}
\keyword{internal}
