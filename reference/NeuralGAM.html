<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit a neuralGAM model — neuralGAM • neuralGAM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a neuralGAM model — neuralGAM"><meta property="og:description" content="Fits a Generalized Additive Model where smooth terms are modeled by keras neural networks.
In addition to point predictions, the model can optionally estimate uncertainty bands via Monte Carlo Dropout across forward passes."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neuralGAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/inesortega/neuralGAM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a neuralGAM model</h1>
    <small class="dont-index">Source: <a href="https://github.com/inesortega/neuralGAM/blob/main/R/NeuralGAM.R" class="external-link"><code>R/NeuralGAM.R</code></a></small>
    <div class="hidden name"><code>NeuralGAM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits a Generalized Additive Model where smooth terms are modeled by <code>keras</code> neural networks.
In addition to point predictions, the model can optionally estimate <strong>uncertainty bands</strong> via Monte Carlo Dropout across forward passes.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">neuralGAM</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  num_units <span class="op">=</span> <span class="fl">64</span>,</span>
<span>  learning_rate <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  activation <span class="op">=</span> <span class="st">"relu"</span>,</span>
<span>  kernel_initializer <span class="op">=</span> <span class="st">"glorot_normal"</span>,</span>
<span>  kernel_regularizer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bias_regularizer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bias_initializer <span class="op">=</span> <span class="st">"zeros"</span>,</span>
<span>  activity_regularizer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"mse"</span>,</span>
<span>  uncertainty_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"epistemic"</span><span class="op">)</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  forward_passes <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  dropout_rate <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  validation_split <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  w_train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bf_threshold <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  ls_threshold <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  max_iter_backfitting <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  max_iter_ls <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Model formula. Smooth terms must be wrapped in <code>s(...)</code>.
You can specify per-term NN settings, e.g.:
<code>y ~ s(x1, num_units = 1024) + s(x3, num_units = c(1024, 512))</code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame containing the variables.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>Response distribution: <code>"gaussian"</code>, <code>"binomial"</code>, <code>"poisson"</code>.</p></dd>


<dt id="arg-num-units">num_units<a class="anchor" aria-label="anchor" href="#arg-num-units"></a></dt>
<dd><p>Default hidden layer sizes for smooth terms (integer or vector).
<strong>Mandatory</strong> unless every <code>s(...)</code> specifies its own <code>num_units</code>.</p></dd>


<dt id="arg-learning-rate">learning_rate<a class="anchor" aria-label="anchor" href="#arg-learning-rate"></a></dt>
<dd><p>Learning rate for Adam optimizer.</p></dd>


<dt id="arg-activation">activation<a class="anchor" aria-label="anchor" href="#arg-activation"></a></dt>
<dd><p>Activation function for hidden layers. Either a string understood by
<code>tf$keras$activations$get()</code> or a function.</p></dd>


<dt id="arg-kernel-initializer-bias-initializer">kernel_initializer, bias_initializer<a class="anchor" aria-label="anchor" href="#arg-kernel-initializer-bias-initializer"></a></dt>
<dd><p>Initializers for weights and biases.</p></dd>


<dt id="arg-kernel-regularizer-bias-regularizer-activity-regularizer">kernel_regularizer, bias_regularizer, activity_regularizer<a class="anchor" aria-label="anchor" href="#arg-kernel-regularizer-bias-regularizer-activity-regularizer"></a></dt>
<dd><p>Optional Keras regularizers.</p></dd>


<dt id="arg-loss">loss<a class="anchor" aria-label="anchor" href="#arg-loss"></a></dt>
<dd><p>Loss function to use. Can be any Keras built-in (e.g., <code>"mse"</code>, <code>"mae"</code>,
<code>"huber"</code>, <code>"logcosh"</code>) or a custom function, passed directly to <code><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">keras::compile()</a></code>.</p></dd>


<dt id="arg-uncertainty-method">uncertainty_method<a class="anchor" aria-label="anchor" href="#arg-uncertainty-method"></a></dt>
<dd><p>Character string indicating the type of uncertainty to estimate.
One of:</p><ul><li><p><code>"none"</code> (default): no uncertainty estimation.</p></li>
<li><p><code>"epistemic"</code>: MC Dropout for mean uncertainty (CIs)</p></li>
</ul></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Significance level for confidence intervals, e.g. <code>0.05</code> for 95% coverage.</p></dd>


<dt id="arg-forward-passes">forward_passes<a class="anchor" aria-label="anchor" href="#arg-forward-passes"></a></dt>
<dd><p>Integer. Number of MC-dropout forward passes used when
<code>uncertainty_method %in% c("epistemic","both")</code>.</p></dd>


<dt id="arg-dropout-rate">dropout_rate<a class="anchor" aria-label="anchor" href="#arg-dropout-rate"></a></dt>
<dd><p>Dropout probability in smooth-term NNs (0,1).</p><ul><li><p>During training: acts as a regularizer.</p></li>
<li><p>During prediction (if <code>uncertainty_method</code> is "epistemic"): enables MC Dropout sampling.</p></li>
</ul></dd>


<dt id="arg-validation-split">validation_split<a class="anchor" aria-label="anchor" href="#arg-validation-split"></a></dt>
<dd><p>Optional fraction of training data used for validation.</p></dd>


<dt id="arg-w-train">w_train<a class="anchor" aria-label="anchor" href="#arg-w-train"></a></dt>
<dd><p>Optional training weights.</p></dd>


<dt id="arg-bf-threshold">bf_threshold<a class="anchor" aria-label="anchor" href="#arg-bf-threshold"></a></dt>
<dd><p>Convergence criterion of the backfitting algorithm. Defaults to <code>0.001</code></p></dd>


<dt id="arg-ls-threshold">ls_threshold<a class="anchor" aria-label="anchor" href="#arg-ls-threshold"></a></dt>
<dd><p>Convergence criterion of the local scoring algorithm. Defaults to <code>0.1</code></p></dd>


<dt id="arg-max-iter-backfitting">max_iter_backfitting<a class="anchor" aria-label="anchor" href="#arg-max-iter-backfitting"></a></dt>
<dd><p>An integer with the maximum number of iterations
of the backfitting algorithm. Defaults to <code>10</code>.</p></dd>


<dt id="arg-max-iter-ls">max_iter_ls<a class="anchor" aria-label="anchor" href="#arg-max-iter-ls"></a></dt>
<dd><p>An integer with the maximum number of iterations of the local scoring Algorithm. Defaults to <code>10</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Random seed.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Verbosity: <code>0</code> silent, <code>1</code> progress messages.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://rdrr.io/pkg/keras/man/optimizer_adam.html" class="external-link">keras::optimizer_adam()</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of class <code>"neuralGAM"</code>, a list with elements including:</p><dl><dt>muhat</dt>
<dd><p>Numeric vector of fitted mean predictions (training data).</p></dd>

<dt>partial</dt>
<dd><p>Data frame of partial contributions \(g_j(x_j)\) per smooth term.</p></dd>

<dt>y</dt>
<dd><p>Observed response values.</p></dd>

<dt>eta</dt>
<dd><p>Linear predictor \(\eta = \eta_0 + \sum_j g_j(x_j)\).</p></dd>

<dt>lwr,upr</dt>
<dd><p>Lower/upper confidence interval bounds (response scale)</p></dd>

<dt>x</dt>
<dd><p>Training covariates (inputs).</p></dd>

<dt>model</dt>
<dd><p>List of fitted Keras models, one per smooth term (+ <code>"linear"</code> if present).</p></dd>

<dt>eta0</dt>
<dd><p>Intercept estimate \(\eta_0\).</p></dd>

<dt>family</dt>
<dd><p>Model family.</p></dd>

<dt>stats</dt>
<dd><p>Data frame of training/validation losses per backfitting iteration.</p></dd>

<dt>mse</dt>
<dd><p>Training mean squared error.</p></dd>

<dt>formula</dt>
<dd><p>Parsed model formula (via <code><a href="get_formula_elements.html">get_formula_elements()</a></code>).</p></dd>

<dt>history</dt>
<dd><p>List of Keras training histories per term.</p></dd>

<dt>globals</dt>
<dd><p>Global hyperparameter defaults.</p></dd>

<dt>alpha</dt>
<dd><p>PI significance level (if trained with uncertainty).</p></dd>

<dt>build_pi</dt>
<dd><p>Logical; whether the model was trained with uancertainty estimation enabled</p></dd>

<dt>uncertainty_method</dt>
<dd><p>Type of predictive uncertainty used ("none","epistemic").</p></dd>

<dt>var_epistemic</dt>
<dd><p>Matrix of per-term epistemic variances (if computed).</p></dd>


</dl></div>
    <div id="author">
    <h2>Author</h2>
    <p>Ines Ortega-Fernandez, Marta Sestelo.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inesortega.github.io/neuralGAM/" class="external-link">neuralGAM</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_neuralGAM_data.html">sim_neuralGAM_data</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">train</span></span></span>
<span class="r-in"><span><span class="va">test</span>  <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">test</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Per-term architecture and confidence intervals</span></span></span>
<span class="r-in"><span><span class="va">ngam</span> <span class="op">&lt;-</span> <span class="fu">neuralGAM</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">x1</span>, num_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">128</span>,<span class="fl">64</span><span class="op">)</span>, activation <span class="op">=</span> <span class="st">"tanh"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>       <span class="fu">s</span><span class="op">(</span><span class="va">x2</span>, num_units <span class="op">=</span> <span class="fl">256</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">train</span>,</span></span>
<span class="r-in"><span>  uncertainty_method <span class="op">=</span> <span class="st">"epistemic"</span>,</span></span>
<span class="r-in"><span>  forward_passes <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  alpha <span class="op">=</span> <span class="fl">0.05</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Initializing neuralGAM..."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 1 - Current Err =  135.081947243743 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 2 - Current Err =  0.0770653069662017 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 3 - Current Err =  0.00253847012192288 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 4 - Current Err =  0.00291195558524542 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 5 - Current Err =  0.00494876238025489 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 6 - Current Err =  0.00427861823924015 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 7 - Current Err =  0.00246589262739314 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 8 - Current Err =  0.00120736035971942 BF Threshold =  0.001 Converged =  FALSE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BACKFITTING Iteration 9 - Current Err =  0.00052235319973483 BF Threshold =  0.001 Converged =  TRUE"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Computing CI/PI using uncertainty_method =  epistemic  at alpha =  0.05"</span>
<span class="r-in"><span><span class="va">ngam</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Class: neuralGAM </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family             : gaussian</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula            : y ~ s(x1, num_units = c(128, 64), activation = "tanh") + s(x2,     num_units = 256)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations       : 1400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept (eta0)   : 4.54772</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deviance explained : 85.66%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Train MSE          : 1.90146</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pred. / Conf. Int. : ENABLED (alpha = 0.05, method = epistemic)</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Ines Ortega-Fernandez, Marta Sestelo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

