<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Extract structured elements from a model formula — get_formula_elements • neuralGAM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Extract structured elements from a model formula — get_formula_elements"><meta property="og:description" content="Parses a GAM-style formula and separates the response, all terms, smooth
(non‑parametric) terms declared via s(...), and parametric terms. In addition,
it extracts per‑term neural network specifications that can be written
inline inside each s(...) call (e.g., num_units, activation,
kernel_initializer, bias_initializer, kernel_regularizer,
bias_regularizer, activity_regularizer).
This function uses an abstract syntax tree (AST) walker (no regex) to read
the arguments of each s(var, ...). Arguments are evaluated in the caller’s
environment. For *_regularizer and *_initializer arguments, proper Keras
objects are required (e.g., keras::regularizer_l2(1e-4),
keras::initializer_glorot_uniform())."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">neuralGAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/inesortega/neuralGAM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract structured elements from a model formula</h1>
    <small class="dont-index">Source: <a href="https://github.com/inesortega/neuralGAM/blob/main/R/formula.R" class="external-link"><code>R/formula.R</code></a></small>
    <div class="hidden name"><code>get_formula_elements.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Parses a GAM-style formula and separates the response, all terms, smooth
(non‑parametric) terms declared via <code>s(...)</code>, and parametric terms. In addition,
it extracts <strong>per‑term neural network specifications</strong> that can be written
inline inside each <code>s(...)</code> call (e.g., <code>num_units</code>, <code>activation</code>,
<code>kernel_initializer</code>, <code>bias_initializer</code>, <code>kernel_regularizer</code>,
<code>bias_regularizer</code>, <code>activity_regularizer</code>).</p>
<p>This function uses an abstract syntax tree (AST) walker (no regex) to read
the arguments of each <code>s(var, ...)</code>. Arguments are evaluated in the caller’s
environment. For <code>*_regularizer</code> and <code>*_initializer</code> arguments, <strong>proper Keras
objects are required</strong> (e.g., <code>keras::regularizer_l2(1e-4)</code>,
<code><a href="https://rdrr.io/pkg/keras/man/initializer_glorot_uniform.html" class="external-link">keras::initializer_glorot_uniform()</a></code>).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_formula_elements</span><span class="op">(</span><span class="va">formula</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A model formula. Smooth terms must be written as <code>s(var, ...)</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list with the following elements:</p><dl><dt>y</dt>
<dd><p>Character scalar. The response variable name.</p></dd>

<dt>terms</dt>
<dd><p>Character vector with all variable names on the RHS (both smooth and parametric).</p></dd>

<dt>np_terms</dt>
<dd><p>Character vector with smooth (non‑parametric) variable names extracted from <code>s(...)</code>.</p></dd>

<dt>p_terms</dt>
<dd><p>Character vector with parametric terms (i.e., <code>terms \\ np_terms</code>).</p></dd>

<dt>np_formula</dt>
<dd><p>A formula containing only the <code>s(...)</code> terms (or <code>NULL</code> if none).</p></dd>

<dt>p_formula</dt>
<dd><p>A formula containing only the parametric terms (or <code>NULL</code> if none).</p></dd>

<dt>np_architecture</dt>
<dd><p>Named list keyed by smooth term (e.g., <code>"x1"</code>, <code>"x3"</code>). Each entry is
a list of per‑term settings parsed from <code>s(term, ...)</code>. Supported keys include:
<code>num_units</code> (numeric or numeric vector),
<code>activation</code> (character),
<code>learning_rate</code> (numeric),
<code>kernel_initializer</code> (keras initializer object),
<code>bias_initializer</code> (keras initializer object),
<code>kernel_regularizer</code> (keras regularizer object),
<code>bias_regularizer</code> (keras regularizer object),
<code>activity_regularizer</code> (keras regularizer object).</p></dd>

<dt>formula</dt>
<dd><p>The original formula object.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><strong>Inline per‑term configuration in <code>s(...)</code>.</strong>
You can specify neural network hyperparameters per smooth term, e.g.:</p><div class="sourceCode"><pre><code><span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">x1</span>, num_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1024</span>, <span class="fl">512</span><span class="op">)</span>,</span>
<span>          activation <span class="op">=</span> <span class="st">"tanh"</span>,</span>
<span>          kernel_regularizer <span class="op">=</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/regularizer_l1.html" class="external-link">regularizer_l2</a></span><span class="op">(</span><span class="fl">1e-4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="va">x2</span> <span class="op">+</span></span>
<span>      <span class="fu">s</span><span class="op">(</span><span class="va">x3</span>, num_units <span class="op">=</span> <span class="fl">1024</span>,</span>
<span>          bias_initializer <span class="op">=</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/initializer_zeros.html" class="external-link">initializer_zeros</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p>Values are evaluated in the caller’s environment. For regularizers and
initializers you must pass actual Keras objects (not character strings).</p>
<p><strong>Supported keys.</strong>
Only the keys listed in <code>np_architecture</code> above are recognized.
Unknown keys are ignored with a warning.</p>
<p><strong>Typical usage.</strong>
The returned <code>np_terms</code> and <code>np_architecture</code> are consumed by
model-building code to construct one neural network per smooth term, applying
any per‑term overrides while falling back to global defaults for unspecified keys.</p>
    </div>
    <div id="errors-and-validation">
    <h2>Errors and validation</h2>


<ul><li><p>The first argument of each <code>s(...)</code> must be a symbol naming the variable.</p></li>
<li><p>All additional arguments to <code>s(...)</code> must be named.</p></li>
<li><p><code>*_regularizer</code> must be a Keras regularizer object.</p></li>
<li><p><code>*_initializer</code> must be a Keras initializer object.</p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Ines Ortega-Fernandez, Marta Sestelo</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Ines Ortega-Fernandez, Marta Sestelo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

